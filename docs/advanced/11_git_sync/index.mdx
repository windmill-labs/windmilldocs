import DocCard from '@site/src/components/DocCard';

# Git sync

From the workspace settings, you can set a [git_repository](../../integrations/git_repository.mdx) resource on which the workspace will automatically commit and push scripts, flows and apps to the repository on each [deploy](../../core_concepts/0_draft_and_deploy/index.mdx).

You can use this feature to [Deploy to prod using a git workflow](#git-sync---promotion-mode-deploy-to-prod-using-a-git-workflow).

<div className="grid grid-cols-2 gap-6 mb-4">
	<DocCard
		title="Deploy to prod"
		description="Deploy to prod using a staging workspace"
		href="/docs/advanced/deploy_to_prod"
	/>
</div>

:::tip Version control

For all details on Version control in Windmill, see [Version control](../../advanced/13_version_control/index.mdx).

:::

This video shows how to set up a Git repository for a workspace (Git sync - sync mode).

<iframe
	style={{ aspectRatio: '16/9' }}
	src="https://www.youtube.com/embed/cHrREDmrnUM?vq=hd1080&hd=1&quality=highres"
	title="Git sync"
	frameBorder="0"
	allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
	allowFullScreen
	className="border-2 rounded-lg object-cover w-full dark:border-gray-800"
></iframe>

<br />

## Git sync - Sync mode

All scripts, flows and apps located in the workspace will be pushed to the Git repository. You can filter Git sync on [path](../../core_concepts/16_roles_and_permissions/index.mdx#path) so that only the scripts, flows and apps with a matching path will be pushed to the Git repository. By default, everything in [folders](../../core_concepts/8_groups_and_folders/index.mdx) will be synced (with rule `f/**`).

On each [deployment](../../core_concepts/0_draft_and_deploy/index.mdx#deployed-version), only the updated script/flow/app will be pushed to the remote Git repository.

This feature is [Cloud & Enterprise Self-Hosted](/pricing) only.

Note that you can explicitly exclude (or include) specific files or folders to be taken into account with a [`wmill.yaml` file](https://github.com/windmill-labs/windmill-sync-example/blob/main/wmill.yaml).

### Setup

#### 1. Initialize Git repository

First, create a Git repository to store your Windmill workspace:

**Option A: Create empty repository (Recommended)**

Create an empty Git repository on your Git provider (GitHub, GitLab, etc.) without any initial files. Windmill will populate it automatically in the next step.

**Option B: Manual CLI setup**

For more control, you can set up the repository manually using the [Windmill CLI](../3_cli/index.mdx):

1. Use [Windmill CLI](../3_cli/index.mdx) to pull the workspace locally:

```bash
wmill sync pull
```

Configure your [`wmill.yaml`](../3_cli/sync.mdx#wmillyaml) file with the desired filter settings before pushing to Git.

![Pull workpsace](./pull_workspace.png 'Pull workspace')

2. Create a Git repository (in the example, on GitHub) and push the initial workspace content:

```bash
git init
git remote add origin https://github.com/username/reponame.git
git add .
git commit -m 'Initial commit'
git push -u origin main
```

You now have your Windmill workspace on a GitHub repository.

#### 2. Setup in Windmill

1. Go to workspace settings â†’ Git Sync tab
2. Click **+ Add connection**
3. Create or select a [git_repository](../../integrations/git_repository.mdx) resource pointing to your Git repository. You have two authentication options:
   - **GitHub App**: Use the [GitHub App](../../integrations/git_repository.mdx#github-app) for simplified authentication and enhanced security
   - **Personal Access Token**: Use a [token](https://github.com/settings/tokens) with Read-and-write on "Contents". Your URL should be `https://[USERNAME]:[TOKEN]@github.com/[ORG|USER]/[REPO_NAME].git`
4. Select sync mode ([sync mode or promotion mode](#sync-modes))
5. Complete the configuration of the connection and save

![Git sync Setup](./git_sync_setup.png 'Git sync Setup')

If you chose Option A (empty repository), use the "Initialize Git repository" operation to automatically:

- Create the `wmill.yaml` configuration file with your filter settings
- Push the entire workspace content to the Git repository

If the repository already contains a `wmill.yaml` file, the settings will be automatically imported and applied to your workspace configuration.

**Configuration settings**: Git sync filter settings are pulled from the [`wmill.yaml`](../3_cli/sync.mdx#wmillyaml) file in your repository. Once the connection is saved, you can update settings by changing `wmill.yaml` and pulling the settings via the corresponding button.

![Git sync Settings](./settings_pull.png 'Git sync Settings Pull')

#### Signing commits with GPG

If your repo requires signed commits, you can set up GPG on your Windmill instance.

1. Generate a GPG key pair:

```
gpg --full-generate-key
```

2. Add the key to your GithHub account:

```
gpg --armor --export <key_id>
```

Go to your GitHub account settings => "SSH and GPG keys" and add the GPG public key.

3. Add the private key to your Windmill instance:

```
gpg --armor --export-keys <key_id>
```

In the Windmill workspace "Git Sync" settings, edit the "GPG key" field with the GPG private key. Use the email address associated with the key and set the passphrase if you added one.

![GPG key](./add_gpg_key.png 'GPG key')

:::caution Key ID and Email

Make sure to double check that the email address associated with the key is the same as the one you use to commit to the repo. Furthermore, double check that the key id is the same as the one you see in the "GPG key" field on your GitHub account.

<br />
All commits will now be signed and commited as the user matching the email address associated with the
key. 
:::

#### Azure DevOps with Service Principal setup

In Microsoft Entra ID, create an application and a secret (also known as Service Principal - an identity used by applications to access Azure resources).
Create an `azure` resource on your Windmill instance with the application's `client_id`, `client_secret` and `tenant_id`.
On Azure DevOps, add the application to the DevOps organization with the appropriate permissions.
In Git sync settings of your Windmill instance, define a new repository with URL:

```
https://AZURE_DEVOPS_TOKEN(<path_to_the_azure_resource>)@dev.azure.com/<organization>/<project>/_git/<repository>
```

## Filters

### Path filters

Only scripts, flows and apps with their path matching one of the set filters will be synced to the Git repositories below. The filters allow `*'` and `**'` characters, with `*'` matching any character allowed in paths until the next slash (`/`) and `**'` matching anything including slashes.
By default everything in folders (with rule `f/**`) will be synced.

You can configure:

- **Include paths**: Primary patterns for what to sync (e.g., `f/**`)
- **Exclude paths**: Patterns to exclude after include checks

### Type filters

On top of the filter path [above](#path-filters), you can include only certain type of object to be synced with the Git repository.
By default everything is synced.

You can filter on:

- **Scripts** - Individual scripts
- **Flows** - Workflow definitions
- **Apps** - Application definitions
- **Folders** - Folder structure
- **Resources** - Resource instances
- **Variables** - Workspace variables
  - **Include secrets** - Option to include secret variables
- **Schedules** - Scheduled job definitions
- **Resource types**
- **Users** - User definitions
- **Groups** - Group definitions
- **Triggers** - Event triggers (HTTP routes, WebSocket, Postgres, Kafka, NATS, SQS, GCP Pub/Sub, MQTT)
- **Workspace settings** - Global workspace configuration
- **Encryption key** - Workspace encryption key

## Repositories to sync

The changes will be deployed to all the repositories set in the Git sync settings.

### Sync modes

You can choose between two sync modes for each repository:

#### Sync mode (default)

Changes are committed directly to the branch specified in the [git_repository](../../integrations/git_repository.mdx) resource. This is the standard mode for simple workspace synchronization.

When combined with [branch-specific items](../3_cli/branch-specific-items.mdx), different workspaces can sync to different branches while maintaining environment-specific configurations (e.g., production workspace syncs to `prod` branch, development workspace syncs to `dev` branch).

#### Promotion mode

Windmill will create branches per deployed object based on its path, prefixed with 'wm_deploy/'. This enables advanced deployment workflows with pull requests and code review processes.

When promotion mode is enabled, you can choose to:

- **Create one branch per deployed object** (default)
- **Group deployed objects by folder**: Create a branch per folder containing objects being deployed instead

You can configure promotion-specific sync behavior using `promotionOverrides` in your [`wmill.yaml`](../3_cli/sync.mdx#wmillyaml) file. This allows different filter settings when promoting changes to specific branches.

This promotion mode is used to [deploy to a prod workspace using a git workflow](#git-sync---promotion-mode-deploy-to-prod-using-a-git-workflow).

## Repository operations

Each configured repository supports several operations:

- **Test connection**: Verify repository access and credentials
- **Preview changes**: Perform a dry-run to see what would be synced
- **Push to repository**: Send workspace content to git repository
- **Pull from repository**: Get changes from git repository to workspace
- **Pull settings**: Get only wmill.yaml configuration changes
- **Initialize repository**: Set up new git repository with Windmill structure

## wmill.yaml integration

Git sync settings can be controlled via the [`wmill.yaml`](../3_cli/sync.mdx#wmillyaml) file in your repository root. This enables:

- **CLI compatibility**: Settings configured in the UI are compatible with [Windmill CLI](../3_cli/index.mdx)
- **Version-controlled configuration**: Your sync settings are stored in git alongside your code
- **Branch-specific overrides**: Different sync behavior per git branch
- **Promotion-specific settings**: Special configuration for deployment workflows
- **[Branch-specific items](../3_cli/branch-specific-items.mdx)**: Different versions of resources and variables per git branch for environment-specific configurations

The frontend will detect existing `wmill.yaml` files and merge settings appropriately.

## Exclude specific types for this repository only

You can exclude specific types per repository, overriding the global workspace filters.

## Git sync - Promotion mode: Deploy to prod using a git workflow

This feature can be used alongside GiHub Actions to adopt a robust development process for your Windmill scripts, flows and apps,
with for example a Staging Workspace making automatically PRs on a repo that pushes to a Prod workspace upon merge.

![Local development Setup](../4_local_development/local_development.png 'Local development Setup')

<iframe
	style={{ aspectRatio: '16/9' }}
	src="https://www.youtube.com/embed/es8FUC2M73o"
	title="Deploy to a Prod Workspace using a Git Workflow"
	frameBorder="0"
	allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
	allowFullScreen
	className="border-2 rounded-lg object-cover w-full dark:border-gray-800"
></iframe>

<br />

More details at:

<div className="grid grid-cols-2 gap-6 mb-4">
	<DocCard
		title="Deploy to prod using a git workflow"
		description="Windmill integration with Git repositories makes it possible to adopt a robust development process for your Windmill scripts, flows and apps."
		href="/docs/advanced/deploy_gh_gl"
	/>
	<DocCard
		title="Local development"
		description="Develop locally, push to git and deploy automatically to Windmill."
		href="/docs/advanced/local_development"
	/>
	<DocCard
		title="GitHub App"
		description="Install the Windmill GitHub app to simplify setting up Git sync"
		href="/docs/integrations/git_repository#github-app"
	/>
</div>
